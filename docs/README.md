# gaiensai

都立青山高校の外苑祭のチケットシステムおよび周辺サイト。

## 使用方法

`git clone`を使用してこのリポジトリをクローンするか、右上の黄緑色の「Code」というボタンから「Download Zip」を選択し、ダウンロードしてください。その後、`Node.js`をインストール(方法は各自で調べてください。)して、以下のコマンドを打ちます。

`$`から始まる行が打ち込むコマンドで、`$`自身の入力はせず、その右の`npm`から始まる文字を打ってください。`$`がない行は予想される表示です。

```shell
$ npm install
added <パッケージ数> packages, and audited <パッケージ数> packages in <時間>

<パッケージ数> packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities

$ npm run build
> gaiensai@0.0.0 build
> tsc -b && vite build

<省略>
✓ built in 976ms

```

この後、`dist`というフォルダーができていれば成功です。この`dist`にビルドした後の完成品のコードがあるので、このフォルダをWebサーバー等にアップロードしてください。その際、SPAの設定をお願いします(方法はReact SPA サーバー 設定というように検索してください。)。

なお、Cloudflare PagesなどのPaaSを使う場合は、そのサービスの案内に従ってください。

## 設計思想

既存のチケットシステムとは、以下の点で差別化を図っています。

- オフラインでも使用可能。表示側はスクショOK、読み取り側もローカルサーバーを立てて運用するか、オフラインで動作するように設計しています。
- 複雑な操作が不要。特に、外部の人はリンクをクリックする、あるいはもらったスクリーンショットを表示するだけで使えるようになります。
- 非常に堅牢なセキュリティ。QRコードにはEd25519によるデジタル署名が行われているので、不正発行・改ざんは量子コンピューターなどでEd25519が破られるまでは起こりません。また、手入力用のデータ本体も、HMACによるデジタル署名を後ろに10bit分加えて、さらにFeistelのアルゴリズムにより撹拌することで、連番であることの推測を困難にしています。
- 非常に軽量な設計。月末に行われることを考えて、速度制限中でも読み込めるような工夫をしています。
- なるべく来年以降も、コードの変更なしに使える設計を目指しています。

以上の設計のため、他とは違う独自仕様が多々あります。改修担当の方には申し訳ありませんが、ご理解をお願いします。

## Dependencies(依存関係)

ここに書いているものは主要なもののみですので、必ず`packages.json`をご確認ください。

- Preact v10.27.2
- Vite v7.2.4
- TypeScript v5.9.3
- @supabase/supabase-js v2.89.0
- wouter-preact v3.9.0
- react-icons v5.5.0
- uqr v0.1.2

開発用のLinterにはESLint v9.39.2 を使用しています。

また、バックエンドにはsupabaseを、デプロイにはCloudflare Pagesを使用していて、Githubと自動で連携するように設定しています。

### 珍しいDependenciesについて

Preactとは、Reactと同じように使えるにも関わらずファイルサイズを3kBに抑えたライブラリです。Hooksのインポート元が`preact/hooks`になっているなど、若干の差異はありますが、Reactのコードを少ない改修で動かすことができます。

wouterとは、Preactで使えるルーターの1つで、必要最小限の機能しかない代わりに非常に軽量なライブラリとなっています。

supabaseはデータベースや認証機能を提供するBaaS(Backend as a Service)の一つで、@supabase/supabase-jsはそのクライアントサイド用ライブラリです。

uqrは、Javascript用QRコード生成ライブラリです。

## ライセンス

このプロジェクトは、MIT ライセンスのもとで公開しています。どなたでも自由に使用して構いません。
